-- =============================================
-- 跨境电商 ERP SaaS 数据库设计
-- 多租户模式：共享数据库 + tenant_id 隔离
-- 数据库版本：MySQL 8.0+
-- 字符集：utf8mb4
-- =============================================

-- 创建数据库
CREATE DATABASE IF NOT EXISTS `erp_saas` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE `erp_saas`;

-- =============================================
-- 租户 & 用户权限模块
-- =============================================

-- 租户表（SaaS 核心）
CREATE TABLE `sys_tenant` (
`id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '租户ID',
`tenant_code` VARCHAR(50) NOT NULL COMMENT '租户编码（唯一标识）',
`tenant_name` VARCHAR(100) NOT NULL COMMENT '租户名称（企业名称）',
`contact_name` VARCHAR(50) COMMENT '联系人',
`contact_phone` VARCHAR(20) COMMENT '联系电话',
`contact_email` VARCHAR(100) COMMENT '联系邮箱',
`package_id` BIGINT COMMENT '套餐ID',
`expire_time` DATETIME COMMENT '到期时间',
`max_users` INT DEFAULT 10 COMMENT '最大用户数',
`max_shops` INT DEFAULT 5 COMMENT '最大店铺数',
`storage_quota` BIGINT DEFAULT 10737418240 COMMENT '存储配额（字节，默认10GB）',
`status` TINYINT DEFAULT 1 COMMENT '状态：1-正常 2-冻结 3-到期 4-注销',
`logo_url` VARCHAR(255) COMMENT '企业Logo',
`domain` VARCHAR(100) COMMENT '自定义域名',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0 COMMENT '逻辑删除：0-否 1-是',
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_code`),
KEY `idx_status_expire` (`status`, `expire_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='SaaS租户表';

-- 套餐表
CREATE TABLE `sys_package` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`package_name` VARCHAR(50) NOT NULL COMMENT '套餐名称',
`package_code` VARCHAR(30) NOT NULL COMMENT '套餐编码',
`price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '价格（月付）',
`max_users` INT DEFAULT 10 COMMENT '用户数上限',
`max_shops` INT DEFAULT 5 COMMENT '店铺数上限',
`storage_quota` BIGINT DEFAULT 10737418240 COMMENT '存储配额',
`max_orders_per_month` INT DEFAULT 10000 COMMENT '月订单量上限',
`features` JSON COMMENT '功能权限配置JSON',
`sort_order` INT DEFAULT 0,
`status` TINYINT DEFAULT 1 COMMENT '1-启用 0-禁用',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_package_code` (`package_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='SaaS套餐表';

-- 用户表
CREATE TABLE `sys_user` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL COMMENT '租户ID',
`username` VARCHAR(50) NOT NULL COMMENT '用户名',
`password` VARCHAR(128) NOT NULL COMMENT '密码（BCrypt加密）',
`real_name` VARCHAR(50) COMMENT '真实姓名',
`email` VARCHAR(100) COMMENT '邮箱',
`phone` VARCHAR(20) COMMENT '手机号',
`avatar` VARCHAR(255) COMMENT '头像URL',
`dept_id` BIGINT COMMENT '部门ID',
`status` TINYINT DEFAULT 1 COMMENT '状态：1-正常 0-禁用',
`user_type` TINYINT DEFAULT 2 COMMENT '类型：1-超级管理员 2-租户管理员 3-普通用户',
`last_login_time` DATETIME COMMENT '最后登录时间',
`last_login_ip` VARCHAR(50) COMMENT '最后登录IP',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_username` (`tenant_id`, `username`),
KEY `idx_tenant_status` (`tenant_id`, `status`),
KEY `idx_email` (`email`),
KEY `idx_phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

-- 角色表
CREATE TABLE `sys_role` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL COMMENT '租户ID（0为系统预置角色）',
`role_name` VARCHAR(50) NOT NULL,
`role_code` VARCHAR(50) NOT NULL,
`description` VARCHAR(200),
`data_scope` TINYINT DEFAULT 1 COMMENT '数据权限：1-全部 2-本部门 3-本部门及下级 4-仅本人',
`sort_order` INT DEFAULT 0,
`status` TINYINT DEFAULT 1,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `role_code`),
KEY `idx_tenant_status` (`tenant_id`, `status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';

-- 菜单权限表
CREATE TABLE `sys_menu` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`parent_id` BIGINT DEFAULT 0 COMMENT '父菜单ID',
`menu_name` VARCHAR(50) NOT NULL,
`menu_code` VARCHAR(50) NOT NULL,
`menu_type` TINYINT DEFAULT 1 COMMENT '类型：1-目录 2-菜单 3-按钮',
`path` VARCHAR(200) COMMENT '路由路径',
`component` VARCHAR(200) COMMENT '组件路径',
`permission` VARCHAR(100) COMMENT '权限标识',
`icon` VARCHAR(50),
`sort_order` INT DEFAULT 0,
`visible` TINYINT DEFAULT 1 COMMENT '是否显示：1-是 0-否',
`status` TINYINT DEFAULT 1,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='菜单权限表';

-- 用户角色关联表
CREATE TABLE `sys_user_role` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`user_id` BIGINT NOT NULL,
`role_id` BIGINT NOT NULL,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_user_role` (`user_id`, `role_id`),
KEY `idx_tenant_user` (`tenant_id`, `user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户角色关联表';

-- 角色菜单关联表
CREATE TABLE `sys_role_menu` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`role_id` BIGINT NOT NULL,
`menu_id` BIGINT NOT NULL,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_role_menu` (`role_id`, `menu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色菜单关联表';

-- 部门表
CREATE TABLE `sys_dept` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`parent_id` BIGINT DEFAULT 0,
`dept_name` VARCHAR(50) NOT NULL,
`leader_id` BIGINT COMMENT '负责人ID',
`phone` VARCHAR(20),
`email` VARCHAR(100),
`sort_order` INT DEFAULT 0,
`status` TINYINT DEFAULT 1,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
KEY `idx_tenant_parent` (`tenant_id`, `parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='部门表';

-- =============================================
-- 店铺管理模块
-- =============================================

-- 店铺表
CREATE TABLE `shop_store` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`store_code` VARCHAR(50) NOT NULL COMMENT '店铺编码',
`store_name` VARCHAR(100) NOT NULL COMMENT '店铺名称',
`platform` VARCHAR(30) NOT NULL COMMENT '平台：amazon/ebay/shopify/wish/aliexpress',
`platform_store_id` VARCHAR(100) COMMENT '平台店铺ID',
`site` VARCHAR(20) COMMENT '站点：US/UK/DE/JP/CA等',
`currency` VARCHAR(10) DEFAULT 'USD' COMMENT '币种',
`status` TINYINT DEFAULT 1 COMMENT '1-正常 2-授权失效 0-停用',
`auth_status` TINYINT DEFAULT 0 COMMENT '授权状态：0-未授权 1-已授权 2-已过期',
`access_token` TEXT COMMENT '访问令牌（加密存储）',
`refresh_token` TEXT COMMENT '刷新令牌',
`token_expire_time` DATETIME COMMENT '令牌过期时间',
`seller_id` VARCHAR(100) COMMENT '卖家ID',
`mws_auth_token` VARCHAR(255) COMMENT 'MWS授权令牌',
`sync_order_enabled` TINYINT DEFAULT 1 COMMENT '是否同步订单',
`sync_product_enabled` TINYINT DEFAULT 1 COMMENT '是否同步商品',
`last_sync_time` DATETIME COMMENT '最后同步时间',
`manager_id` BIGINT COMMENT '店铺负责人',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `store_code`),
KEY `idx_tenant_platform` (`tenant_id`, `platform`),
KEY `idx_tenant_status` (`tenant_id`, `status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='店铺表';

-- 店铺配置表
CREATE TABLE `shop_store_config` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`store_id` BIGINT NOT NULL,
`config_key` VARCHAR(50) NOT NULL COMMENT '配置键',
`config_value` TEXT COMMENT '配置值（JSON格式）',
`config_type` VARCHAR(30) COMMENT '配置类型：sync/shipping/payment/tax',
`description` VARCHAR(200),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_store_key` (`store_id`, `config_key`),
KEY `idx_tenant_store` (`tenant_id`, `store_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='店铺配置表';

-- =============================================
-- 商品管理模块
-- =============================================

-- 商品SPU表（Standard Product Unit）
CREATE TABLE `product_spu` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`spu_code` VARCHAR(50) NOT NULL COMMENT 'SPU编码',
`spu_name` VARCHAR(200) NOT NULL COMMENT '商品名称',
`category_id` BIGINT COMMENT '分类ID',
`brand` VARCHAR(100) COMMENT '品牌',
`product_type` TINYINT DEFAULT 1 COMMENT '类型：1-普通 2-组合 3-虚拟',
`main_image` VARCHAR(500) COMMENT '主图URL',
`images` JSON COMMENT '图片列表JSON',
`description` TEXT COMMENT '商品描述',
`status` TINYINT DEFAULT 1 COMMENT '状态：1-在售 2-下架 3-草稿',
`weight` DECIMAL(10,3) COMMENT '重量（kg）',
`length` DECIMAL(10,2) COMMENT '长（cm）',
`width` DECIMAL(10,2) COMMENT '宽（cm）',
`height` DECIMAL(10,2) COMMENT '高（cm）',
`customs_name` VARCHAR(200) COMMENT '海关申报名称',
`customs_name_cn` VARCHAR(200) COMMENT '海关申报中文名',
`hs_code` VARCHAR(20) COMMENT 'HS编码',
`declared_value` DECIMAL(10,2) COMMENT '申报价值',
`origin_country` VARCHAR(10) COMMENT '原产国',
`creator_id` BIGINT,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `spu_code`),
KEY `idx_tenant_status` (`tenant_id`, `status`),
KEY `idx_category` (`category_id`),
KEY `idx_brand` (`brand`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品SPU表';

-- 商品SKU表（Stock Keeping Unit）
CREATE TABLE `product_sku` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`spu_id` BIGINT NOT NULL,
`sku_code` VARCHAR(50) NOT NULL COMMENT 'SKU编码',
`sku_name` VARCHAR(200) COMMENT 'SKU名称',
`barcode` VARCHAR(50) COMMENT '条形码',
`spec_values` JSON COMMENT '规格值JSON：{"Color":"Red","Size":"L"}',
`cost_price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '成本价',
`market_price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '市场价',
`sale_price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '销售价',
`weight` DECIMAL(10,3) COMMENT '重量（kg）',
`image` VARCHAR(500) COMMENT 'SKU图片',
`status` TINYINT DEFAULT 1 COMMENT '1-启用 0-禁用',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_sku` (`tenant_id`, `sku_code`),
KEY `idx_tenant_spu` (`tenant_id`, `spu_id`),
KEY `idx_barcode` (`barcode`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品SKU表';

-- 商品分类表
CREATE TABLE `product_category` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`parent_id` BIGINT DEFAULT 0,
`category_name` VARCHAR(100) NOT NULL,
`category_code` VARCHAR(50),
`level` TINYINT DEFAULT 1 COMMENT '层级：1/2/3',
`image` VARCHAR(500),
`sort_order` INT DEFAULT 0,
`status` TINYINT DEFAULT 1,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
KEY `idx_tenant_parent` (`tenant_id`, `parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品分类表';

-- 商品Listing表（平台刊登）
CREATE TABLE `product_listing` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`store_id` BIGINT NOT NULL COMMENT '店铺ID',
`sku_id` BIGINT NOT NULL COMMENT '关联SKU',
`platform_sku` VARCHAR(100) COMMENT '平台SKU',
`platform_listing_id` VARCHAR(100) COMMENT '平台商品ID（ASIN/ItemID）',
`title` VARCHAR(500) COMMENT '商品标题',
`price` DECIMAL(10,2) COMMENT '销售价格',
`quantity` INT DEFAULT 0 COMMENT '在售数量',
`listing_status` VARCHAR(30) COMMENT '平台状态：Active/Inactive/Incomplete',
`sync_status` TINYINT DEFAULT 1 COMMENT '同步状态：1-正常 2-失败',
`last_sync_time` DATETIME,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_store_platform_sku` (`store_id`, `platform_sku`),
KEY `idx_tenant_store` (`tenant_id`, `store_id`),
KEY `idx_sku` (`sku_id`),
KEY `idx_platform_listing` (`platform_listing_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品Listing表';

-- =============================================
-- 库存管理模块
-- =============================================

-- 仓库表
CREATE TABLE `warehouse` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`warehouse_code` VARCHAR(50) NOT NULL,
`warehouse_name` VARCHAR(100) NOT NULL,
`warehouse_type` TINYINT DEFAULT 1 COMMENT '类型：1-自有仓 2-第三方仓 3-FBA仓 4-海外仓',
`country` VARCHAR(10),
`province` VARCHAR(50),
`city` VARCHAR(50),
`address` VARCHAR(200),
`contact_name` VARCHAR(50),
`contact_phone` VARCHAR(20),
`manager_id` BIGINT COMMENT '仓库负责人',
`status` TINYINT DEFAULT 1,
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `warehouse_code`),
KEY `idx_tenant_type` (`tenant_id`, `warehouse_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='仓库表';

-- 库存表
CREATE TABLE `inventory_stock` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`warehouse_id` BIGINT NOT NULL,
`sku_id` BIGINT NOT NULL,
`available_quantity` INT DEFAULT 0 COMMENT '可用库存',
`locked_quantity` INT DEFAULT 0 COMMENT '锁定库存（已下单未发货）',
`in_transit_quantity` INT DEFAULT 0 COMMENT '在途库存',
`defective_quantity` INT DEFAULT 0 COMMENT '次品库存',
`total_quantity` INT GENERATED ALWAYS AS (available_quantity + locked_quantity + in_transit_quantity + defective_quantity) VIRTUAL COMMENT '总库存',
`warning_quantity` INT DEFAULT 10 COMMENT '预警数量',
`last_in_time` DATETIME COMMENT '最后入库时间',
`last_out_time` DATETIME COMMENT '最后出库时间',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_warehouse_sku` (`warehouse_id`, `sku_id`),
KEY `idx_tenant_warehouse` (`tenant_id`, `warehouse_id`),
KEY `idx_sku` (`sku_id`),
KEY `idx_tenant_available` (`tenant_id`, `available_quantity`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='库存表';

-- 库存流水表
CREATE TABLE `inventory_log` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`warehouse_id` BIGINT NOT NULL,
`sku_id` BIGINT NOT NULL,
`log_type` TINYINT NOT NULL COMMENT '类型：1-入库 2-出库 3-锁定 4-解锁 5-盘点 6-报损',
`business_type` VARCHAR(30) COMMENT '业务类型：purchase/order/adjust/return',
`business_id` BIGINT COMMENT '业务单号ID',
`business_code` VARCHAR(50) COMMENT '业务单号',
`quantity_before` INT COMMENT '变更前数量',
`quantity_change` INT COMMENT '变更数量（正负）',
`quantity_after` INT COMMENT '变更后数量',
`operator_id` BIGINT,
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_warehouse` (`tenant_id`, `warehouse_id`),
KEY `idx_sku_time` (`sku_id`, `create_time`),
KEY `idx_business` (`business_type`, `business_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='库存流水表';

-- 库存盘点表
CREATE TABLE `inventory_check` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`check_code` VARCHAR(50) NOT NULL COMMENT '盘点单号',
`warehouse_id` BIGINT NOT NULL,
`check_type` TINYINT DEFAULT 1 COMMENT '盘点类型：1-全盘 2-抽盘 3-动碰盘',
`status` TINYINT DEFAULT 1 COMMENT '状态：1-盘点中 2-已完成 3-已取消',
`plan_time` DATETIME COMMENT '计划盘点时间',
`start_time` DATETIME COMMENT '开始时间',
`finish_time` DATETIME COMMENT '完成时间',
`checker_id` BIGINT COMMENT '盘点人',
`approver_id` BIGINT COMMENT '审核人',
`total_sku_count` INT DEFAULT 0 COMMENT 'SKU总数',
`checked_sku_count` INT DEFAULT 0 COMMENT '已盘点SKU数',
`profit_count` INT DEFAULT 0 COMMENT '盘盈数量',
`loss_count` INT DEFAULT 0 COMMENT '盘亏数量',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `check_code`),
KEY `idx_tenant_warehouse` (`tenant_id`, `warehouse_id`),
KEY `idx_status_plan` (`status`, `plan_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='库存盘点表';

-- 盘点明细表
CREATE TABLE `inventory_check_detail` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`check_id` BIGINT NOT NULL,
`sku_id` BIGINT NOT NULL,
`system_quantity` INT DEFAULT 0 COMMENT '系统库存',
`actual_quantity` INT DEFAULT 0 COMMENT '实际库存',
`diff_quantity` INT DEFAULT 0 COMMENT '差异数量',
`status` TINYINT DEFAULT 1 COMMENT '1-待盘点 2-已盘点 3-已审核',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_check_id` (`check_id`),
KEY `idx_tenant_sku` (`tenant_id`, `sku_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='盘点明细表';

-- =============================================
-- 订单管理模块
-- =============================================

-- 订单表
CREATE TABLE `order_main` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`order_code` VARCHAR(50) NOT NULL COMMENT '系统订单号',
`store_id` BIGINT NOT NULL COMMENT '店铺ID',
`platform_order_id` VARCHAR(100) NOT NULL COMMENT '平台订单号',
`platform` VARCHAR(30) NOT NULL COMMENT '平台',
`order_type` TINYINT DEFAULT 1 COMMENT '类型：1-普通 2-FBA 3-补发',
`order_status` TINYINT DEFAULT 1 COMMENT '状态：1-待付款 2-待发货 3-已发货 4-已完成 5-已取消 6-退款中 7-已退款',
`payment_status` TINYINT DEFAULT 0 COMMENT '支付状态：0-未支付 1-已支付 2-部分退款 3-全额退款',
`shipment_status` TINYINT DEFAULT 0 COMMENT '发货状态：0-未发货 1-部分发货 2-已发货 3-已签收',
`buyer_id` VARCHAR(100) COMMENT '买家ID',
`buyer_name` VARCHAR(100) COMMENT '买家姓名',
`buyer_email` VARCHAR(100),
`buyer_phone` VARCHAR(20),
`currency` VARCHAR(10) DEFAULT 'USD',
`total_amount` DECIMAL(12,2) DEFAULT 0.00 COMMENT '订单总额',
`product_amount` DECIMAL(12,2) DEFAULT 0.00 COMMENT '商品金额',
`shipping_fee` DECIMAL(10,2) DEFAULT 0.00 COMMENT '运费',
`tax_amount` DECIMAL(10,2) DEFAULT 0.00 COMMENT '税费',
`discount_amount` DECIMAL(10,2) DEFAULT 0.00 COMMENT '折扣金额',
`actual_amount` DECIMAL(12,2) DEFAULT 0.00 COMMENT '实付金额',
`platform_fee` DECIMAL(10,2) DEFAULT 0.00 COMMENT '平台佣金',
`payment_method` VARCHAR(30) COMMENT '支付方式',
`payment_time` DATETIME COMMENT '支付时间',
`ship_country` VARCHAR(50) COMMENT '收货国家',
`ship_province` VARCHAR(50) COMMENT '收货省/州',
`ship_city` VARCHAR(50) COMMENT '收货城市',
`ship_address1` VARCHAR(200) COMMENT '地址1',
`ship_address2` VARCHAR(200) COMMENT '地址2',
`ship_zip_code` VARCHAR(20) COMMENT '邮编',
`ship_phone` VARCHAR(20) COMMENT '收货电话',
`warehouse_id` BIGINT COMMENT '发货仓库',
`is_urgent` TINYINT DEFAULT 0 COMMENT '是否加急',
`is_split` TINYINT DEFAULT 0 COMMENT '是否拆单',
`parent_order_id` BIGINT COMMENT '父订单ID（拆单用）',
`buyer_remark` VARCHAR(500) COMMENT '买家备注',
`seller_remark` VARCHAR(500) COMMENT '卖家备注',
`platform_created_time` DATETIME COMMENT '平台下单时间',
`sync_time` DATETIME COMMENT '同步时间',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_order_code` (`tenant_id`, `order_code`),
UNIQUE KEY `uk_platform_order` (`platform`, `platform_order_id`),
KEY `idx_tenant_store` (`tenant_id`, `store_id`),
KEY `idx_tenant_status` (`tenant_id`, `order_status`),
KEY `idx_payment_time` (`payment_time`),
KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单主表';

-- 订单明细表
CREATE TABLE `order_item` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`order_id` BIGINT NOT NULL COMMENT '订单ID',
`sku_id` BIGINT NOT NULL COMMENT 'SKU ID',
`sku_code` VARCHAR(50) NOT NULL,
`platform_sku` VARCHAR(100) COMMENT '平台SKU',
`product_name` VARCHAR(200),
`product_image` VARCHAR(500),
`spec_values` JSON COMMENT '规格信息',
`quantity` INT DEFAULT 1 COMMENT '购买数量',
`price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '单价',
`total_amount` DECIMAL(12,2) DEFAULT 0.00 COMMENT '小计',
`cost_price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '成本价',
`platform_item_id` VARCHAR(100) COMMENT '平台商品ID',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_order` (`tenant_id`, `order_id`),
KEY `idx_sku` (`sku_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单明细表';

-- 订单状态流转表
CREATE TABLE `order_status_log` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`order_id` BIGINT NOT NULL,
`status_before` TINYINT COMMENT '变更前状态',
`status_after` TINYINT COMMENT '变更后状态',
`operator_id` BIGINT,
`operator_name` VARCHAR(50),
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_order` (`tenant_id`, `order_id`),
KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单状态流转表';

-- =============================================
-- 物流管理模块
-- =============================================

-- 物流方式表
CREATE TABLE `logistics_channel` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`channel_code` VARCHAR(50) NOT NULL COMMENT '物流渠道编码',
`channel_name` VARCHAR(100) NOT NULL,
`carrier` VARCHAR(50) COMMENT '承运商：FedEx/DHL/UPS/USPS',
`channel_type` TINYINT DEFAULT 1 COMMENT '类型：1-商业快递 2-邮政小包 3-专线物流 4-海外仓',
`country_codes` JSON COMMENT '支持国家列表',
`min_weight` DECIMAL(10,3) DEFAULT 0 COMMENT '最小重量（kg）',
`max_weight` DECIMAL(10,3) DEFAULT 30 COMMENT '最大重量（kg）',
`aging_days` INT COMMENT '时效（天）',
`is_tracked` TINYINT DEFAULT 1 COMMENT '是否可追踪',
`sort_order` INT DEFAULT 0,
`status` TINYINT DEFAULT 1,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `channel_code`),
KEY `idx_tenant_status` (`tenant_id`, `status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='物流方式表';

-- 物流运费模板表
CREATE TABLE `logistics_fee_template` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`channel_id` BIGINT NOT NULL,
`template_name` VARCHAR(100),
`country_code` VARCHAR(10) COMMENT '国家代码',
`first_weight` DECIMAL(10,3) DEFAULT 0.5 COMMENT '首重（kg）',
`first_fee` DECIMAL(10,2) DEFAULT 0.00 COMMENT '首重费用',
`continue_weight` DECIMAL(10,3) DEFAULT 0.5 COMMENT '续重（kg）',
`continue_fee` DECIMAL(10,2) DEFAULT 0.00 COMMENT '续重费用',
`fuel_rate` DECIMAL(5,2) DEFAULT 0.00 COMMENT '燃油附加费率',
`remote_fee` DECIMAL(10,2) DEFAULT 0.00 COMMENT '偏远地区附加费',
`currency` VARCHAR(10) DEFAULT 'USD',
`status` TINYINT DEFAULT 1,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_channel` (`tenant_id`, `channel_id`),
KEY `idx_country` (`country_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='物流运费模板表';

-- 物流包裹表
CREATE TABLE `logistics_package` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`package_code` VARCHAR(50) NOT NULL COMMENT '包裹号',
`order_id` BIGINT NOT NULL,
`order_code` VARCHAR(50),
`warehouse_id` BIGINT COMMENT '发货仓库',
`channel_id` BIGINT COMMENT '物流渠道',
`tracking_number` VARCHAR(100) COMMENT '物流单号',
`carrier` VARCHAR(50) COMMENT '承运商',
`ship_status` TINYINT DEFAULT 1 COMMENT '状态：1-待发货 2-已发货 3-运输中 4-已签收 5-异常',
`actual_weight` DECIMAL(10,3) COMMENT '实际重量（kg）',
`volume_weight` DECIMAL(10,3) COMMENT '体积重（kg）',
`charge_weight` DECIMAL(10,3) COMMENT '计费重（kg）',
`shipping_fee` DECIMAL(10,2) DEFAULT 0.00 COMMENT '运费',
`ship_country` VARCHAR(50),
`ship_address` VARCHAR(500),
`ship_time` DATETIME COMMENT '发货时间',
`delivered_time` DATETIME COMMENT '签收时间',
`label_url` VARCHAR(500) COMMENT '面单URL',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `package_code`),
KEY `idx_tenant_order` (`tenant_id`, `order_id`),
KEY `idx_tracking` (`tracking_number`),
KEY `idx_ship_status` (`ship_status`, `ship_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='物流包裹表';

-- 物流轨迹表
CREATE TABLE `logistics_track` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`package_id` BIGINT NOT NULL,
`tracking_number` VARCHAR(100),
`track_status` VARCHAR(50) COMMENT '轨迹状态',
`track_content` VARCHAR(500) COMMENT '轨迹内容',
`track_location` VARCHAR(200) COMMENT '所在地',
`track_time` DATETIME COMMENT '轨迹时间',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_package` (`package_id`),
KEY `idx_tracking` (`tracking_number`),
KEY `idx_track_time` (`track_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='物流轨迹表';

-- =============================================
-- 采购管理模块
-- =============================================

-- 供应商表
CREATE TABLE `supplier` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`supplier_code` VARCHAR(50) NOT NULL,
`supplier_name` VARCHAR(100) NOT NULL,
`supplier_type` TINYINT DEFAULT 1 COMMENT '类型：1-生产商 2-批发商 3-代理商',
`contact_name` VARCHAR(50),
`contact_phone` VARCHAR(20),
`contact_email` VARCHAR(100),
`country` VARCHAR(50),
`province` VARCHAR(50),
`city` VARCHAR(50),
`address` VARCHAR(200),
`payment_term` VARCHAR(50) COMMENT '付款方式：预付/货到付款/月结',
`payment_days` INT DEFAULT 0 COMMENT '账期（天）',
`credit_limit` DECIMAL(12,2) DEFAULT 0.00 COMMENT '信用额度',
`tax_number` VARCHAR(50) COMMENT '税号',
`bank_name` VARCHAR(100) COMMENT '开户行',
`bank_account` VARCHAR(50) COMMENT '银行账号',
`rating` TINYINT DEFAULT 3 COMMENT '评级：1-5星',
`status` TINYINT DEFAULT 1 COMMENT '1-合作中 0-已停用',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `supplier_code`),
KEY `idx_tenant_status` (`tenant_id`, `status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='供应商表';

-- 采购单表
CREATE TABLE `purchase_order` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`purchase_code` VARCHAR(50) NOT NULL COMMENT '采购单号',
`supplier_id` BIGINT NOT NULL,
`warehouse_id` BIGINT COMMENT '入库仓库',
`purchase_type` TINYINT DEFAULT 1 COMMENT '类型：1-普通采购 2-补货采购 3-样品采购',
`status` TINYINT DEFAULT 1 COMMENT '状态：1-待审核 2-已审核 3-采购中 4-部分到货 5-已完成 6-已取消',
`total_amount` DECIMAL(12,2) DEFAULT 0.00 COMMENT '采购总额',
`paid_amount` DECIMAL(12,2) DEFAULT 0.00 COMMENT '已付金额',
`currency` VARCHAR(10) DEFAULT 'CNY',
`expected_date` DATE COMMENT '期望到货日期',
`buyer_id` BIGINT COMMENT '采购员',
`approver_id` BIGINT COMMENT '审核人',
`approve_time` DATETIME COMMENT '审核时间',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`is_deleted` TINYINT DEFAULT 0,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `purchase_code`),
KEY `idx_tenant_supplier` (`tenant_id`, `supplier_id`),
KEY `idx_tenant_status` (`tenant_id`, `status`),
KEY `idx_expected_date` (`expected_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='采购单表';

-- 采购单明细表
CREATE TABLE `purchase_order_item` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`purchase_id` BIGINT NOT NULL,
`sku_id` BIGINT NOT NULL,
`sku_code` VARCHAR(50),
`product_name` VARCHAR(200),
`quantity` INT DEFAULT 0 COMMENT '采购数量',
`received_quantity` INT DEFAULT 0 COMMENT '已到货数量',
`price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '采购单价',
`total_amount` DECIMAL(12,2) DEFAULT 0.00 COMMENT '小计',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_purchase` (`tenant_id`, `purchase_id`),
KEY `idx_sku` (`sku_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='采购单明细表';

-- 采购入库单表
CREATE TABLE `purchase_inbound` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`inbound_code` VARCHAR(50) NOT NULL COMMENT '入库单号',
`purchase_id` BIGINT NOT NULL,
`warehouse_id` BIGINT NOT NULL,
`inbound_type` TINYINT DEFAULT 1 COMMENT '类型：1-采购入库 2-退货入库 3-调拨入库',
`status` TINYINT DEFAULT 1 COMMENT '状态：1-待入库 2-部分入库 3-已完成',
`total_quantity` INT DEFAULT 0 COMMENT '计划数量',
`received_quantity` INT DEFAULT 0 COMMENT '实收数量',
`receiver_id` BIGINT COMMENT '收货人',
`receive_time` DATETIME COMMENT '收货时间',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `inbound_code`),
KEY `idx_tenant_purchase` (`tenant_id`, `purchase_id`),
KEY `idx_warehouse` (`warehouse_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='采购入库单表';

-- 采购入库明细表
CREATE TABLE `purchase_inbound_item` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`inbound_id` BIGINT NOT NULL,
`sku_id` BIGINT NOT NULL,
`plan_quantity` INT DEFAULT 0 COMMENT '计划数量',
`actual_quantity` INT DEFAULT 0 COMMENT '实收数量',
`defective_quantity` INT DEFAULT 0 COMMENT '次品数量',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_inbound` (`inbound_id`),
KEY `idx_tenant_sku` (`tenant_id`, `sku_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='采购入库明细表';

-- =============================================
-- 财务管理模块
-- =============================================

-- 收款单表
CREATE TABLE `finance_receipt` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`receipt_code` VARCHAR(50) NOT NULL,
`order_id` BIGINT COMMENT '关联订单',
`order_code` VARCHAR(50),
`receipt_type` TINYINT DEFAULT 1 COMMENT '类型：1-订单收款 2-退款 3-其他',
`payment_method` VARCHAR(30) COMMENT 'PayPal/Stripe/信用卡',
`amount` DECIMAL(12,2) DEFAULT 0.00,
`currency` VARCHAR(10) DEFAULT 'USD',
`transaction_id` VARCHAR(100) COMMENT '交易流水号',
`payment_time` DATETIME,
`status` TINYINT DEFAULT 1 COMMENT '1-待确认 2-已确认 3-已撤销',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `receipt_code`),
KEY `idx_tenant_order` (`tenant_id`, `order_id`),
KEY `idx_transaction` (`transaction_id`),
KEY `idx_payment_time` (`payment_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='收款单表';

-- 付款单表
CREATE TABLE `finance_payment` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`payment_code` VARCHAR(50) NOT NULL,
`payment_type` TINYINT DEFAULT 1 COMMENT '类型：1-采购付款 2-物流付款 3-费用支出 4-其他',
`business_id` BIGINT COMMENT '业务单据ID',
`business_code` VARCHAR(50) COMMENT '业务单据号',
`payee_type` TINYINT DEFAULT 1 COMMENT '收款方：1-供应商 2-物流商 3-其他',
`payee_id` BIGINT COMMENT '收款方ID',
`payee_name` VARCHAR(100),
`amount` DECIMAL(12,2) DEFAULT 0.00,
`currency` VARCHAR(10) DEFAULT 'CNY',
`payment_method` VARCHAR(30) COMMENT '付款方式',
`payment_account` VARCHAR(100) COMMENT '付款账户',
`payment_time` DATETIME,
`status` TINYINT DEFAULT 1 COMMENT '1-待审核 2-已审核 3-已付款 4-已撤销',
`approver_id` BIGINT,
`approve_time` DATETIME,
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `payment_code`),
KEY `idx_tenant_type` (`tenant_id`, `payment_type`),
KEY `idx_business` (`business_id`, `business_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='付款单表';

-- 费用科目表
CREATE TABLE `finance_expense_category` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`category_code` VARCHAR(50) NOT NULL,
`category_name` VARCHAR(100) NOT NULL,
`parent_id` BIGINT DEFAULT 0,
`category_type` TINYINT DEFAULT 1 COMMENT '类型：1-成本类 2-费用类 3-收入类',
`sort_order` INT DEFAULT 0,
`status` TINYINT DEFAULT 1,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_tenant_code` (`tenant_id`, `category_code`),
KEY `idx_parent` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='费用科目表';

-- =============================================
-- 系统支撑模块
-- =============================================

-- 文件管理表
CREATE TABLE `sys_file` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`file_name` VARCHAR(255) NOT NULL,
`file_path` VARCHAR(500) NOT NULL COMMENT 'OSS存储路径',
`file_url` VARCHAR(500) COMMENT '访问URL',
`file_size` BIGINT DEFAULT 0 COMMENT '文件大小（字节）',
`file_type` VARCHAR(50) COMMENT 'MIME类型',
`file_ext` VARCHAR(20) COMMENT '扩展名',
`business_type` VARCHAR(30) COMMENT '业务类型：product/order/document',
`business_id` BIGINT COMMENT '业务ID',
`uploader_id` BIGINT,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_business` (`tenant_id`, `business_type`, `business_id`),
KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文件管理表';

-- 消息通知表
CREATE TABLE `sys_notification` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`notify_type` TINYINT DEFAULT 1 COMMENT '类型：1-系统通知 2-订单通知 3-库存预警 4-财务通知',
`title` VARCHAR(200),
`content` TEXT,
`link_url` VARCHAR(500) COMMENT '跳转链接',
`receiver_id` BIGINT COMMENT '接收人（0为全员）',
`is_read` TINYINT DEFAULT 0 COMMENT '是否已读',
`read_time` DATETIME,
`send_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_receiver` (`tenant_id`, `receiver_id`, `is_read`),
KEY `idx_send_time` (`send_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='消息通知表';

-- 操作日志表
CREATE TABLE `sys_operation_log` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT NOT NULL,
`module` VARCHAR(50) COMMENT '模块名',
`operation` VARCHAR(50) COMMENT '操作类型',
`business_type` VARCHAR(30),
`business_id` BIGINT,
`method` VARCHAR(200) COMMENT '方法名',
`request_method` VARCHAR(10) COMMENT 'GET/POST/PUT/DELETE',
`request_url` VARCHAR(500),
`request_param` TEXT COMMENT '请求参数',
`response_data` TEXT COMMENT '返回数据',
`operator_id` BIGINT,
`operator_name` VARCHAR(50),
`ip_address` VARCHAR(50),
`location` VARCHAR(100),
`status` TINYINT DEFAULT 1 COMMENT '1-成功 0-失败',
`error_msg` TEXT,
`execute_time` INT COMMENT '执行时长（ms）',
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_operator` (`tenant_id`, `operator_id`),
KEY `idx_business` (`business_type`, `business_id`),
KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';

-- 数据字典表
CREATE TABLE `sys_dict_type` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`dict_name` VARCHAR(100) NOT NULL,
`dict_type` VARCHAR(100) NOT NULL COMMENT '字典类型标识',
`status` TINYINT DEFAULT 1,
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
UNIQUE KEY `uk_dict_type` (`dict_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='字典类型表';

-- 字典数据表
CREATE TABLE `sys_dict_data` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`dict_type` VARCHAR(100) NOT NULL,
`dict_label` VARCHAR(100) NOT NULL COMMENT '字典标签',
`dict_value` VARCHAR(100) NOT NULL COMMENT '字典值',
`dict_sort` INT DEFAULT 0,
`status` TINYINT DEFAULT 1,
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_dict_type` (`dict_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='字典数据表';

-- 定时任务表
CREATE TABLE `sys_job` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tenant_id` BIGINT DEFAULT 0 COMMENT '租户ID（0为系统级任务）',
`job_name` VARCHAR(100) NOT NULL,
`job_group` VARCHAR(50) DEFAULT 'DEFAULT',
`bean_name` VARCHAR(100) COMMENT 'Bean名称',
`method_name` VARCHAR(100) COMMENT '方法名',
`params` VARCHAR(500) COMMENT '参数',
`cron_expression` VARCHAR(100) NOT NULL COMMENT 'Cron表达式',
`status` TINYINT DEFAULT 1 COMMENT '1-正常 0-暂停',
`misfire_policy` TINYINT DEFAULT 1 COMMENT '错过策略：1-立即执行 2-执行一次 3-放弃',
`concurrent` TINYINT DEFAULT 0 COMMENT '是否允许并发：0-禁止 1-允许',
`remark` VARCHAR(500),
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
`update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_tenant_status` (`tenant_id`, `status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='定时任务表';

-- 任务执行日志表
CREATE TABLE `sys_job_log` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`job_id` BIGINT NOT NULL,
`job_name` VARCHAR(100),
`execute_time` DATETIME COMMENT '执行时间',
`duration` INT COMMENT '执行时长（ms）',
`status` TINYINT DEFAULT 1 COMMENT '1-成功 0-失败',
`error_msg` TEXT,
`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`),
KEY `idx_job_id` (`job_id`),
KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='任务执行日志表';

-- =============================================
-- 初始化基础数据
-- =============================================

-- 插入系统预置套餐
INSERT INTO `sys_package` (`package_name`, `package_code`, `price`, `max_users`, `max_shops`, `storage_quota`, `max_orders_per_month`, `features`) VALUES
('免费版', 'FREE', 0.00, 2, 1, 1073741824, 100, '{"api_access":false,"advanced_report":false}'),
('专业版', 'PRO', 99.00, 10, 5, 10737418240, 5000, '{"api_access":true,"advanced_report":true}'),
('企业版', 'ENTERPRISE', 299.00, 50, 20, 53687091200, 50000, '{"api_access":true,"advanced_report":true,"custom_domain":true}');

-- 插入系统预置角色
INSERT INTO `sys_role` (`tenant_id`, `role_name`, `role_code`, `description`) VALUES
(0, '超级管理员', 'SUPER_ADMIN', '系统超级管理员'),
(0, '租户管理员', 'TENANT_ADMIN', '租户管理员'),
(0, '普通用户', 'USER', '普通用户');

-- 插入数据字典类型
INSERT INTO `sys_dict_type` (`dict_name`, `dict_type`) VALUES
('订单状态', 'order_status'),
('支付状态', 'payment_status'),
